<!DOCTYPE html>
<html>
<head>
  <title>Temporary Page for Heat Map Visualization</title>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

   <!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

   <!-- Latest compiled JavaScript -->
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

</head>


<body>
 <div class="container">
   <div class="page-header">
	<h1>Temporary Page for Heat Map Visualization</h1>
   </div>

   <div class="row">
	<div class="col-md-1"></div>
	<div class="col-md-10">
          <div class="input-group" style="width:inherit">
	    <label for="score_title">Search for score title:</label>
            <input type="text" class="form-control" id="score_title">
	    <span class="input-group-btn">
        	<button class="btn btn-secondary" type="button" onclick="search()">Search</button>
            </span>
	  </div>
	  <br>
	  <div class="results">
	    <ul id="myList">
	    </ul>
	  </div>
        </div>
	<div class="col-md-1"></div>
 </div>

   <script type="text/javascript">
        var jsonfile;
	$.getJSON('ema.json').done(function (data) {
		jsonfile = data;
	});

  function createRange(meaNumber){
    if(meaNumber.length == 1){
      return parseInt(meaNumber);
    } else{
      fNum = parseInt(meaNumber[0]);
      lNum = parseInt(meaNumber[meaNumber.length-1]);
      return [fNum, lNum];
    }
  }

  function arraysEqual(arr1, arr2) {
    if(arr1.length !== arr2.length)
        return false;
    for(var i = arr1.length; i--;) {
        if(arr1[i] !== arr2[i])
            return false;
    }

    return true;
}

function findArray(value, obJ){
  var results;
  for(var i=0; i < (obJ["data"].length); i++){
      if(value == obJ["data"][i]["label"]){
        results = obJ["data"][i];
      } else{
        results = -1;
      }
    }
    return results;
  }



function search(){
	  var title = document.getElementById("score_title").value ;

	  var fromsongs = jsonfile[title];
    var forVis =[];
    var dataOut = {};
    dataOut["group"] = title;
    dataOut["data"] = [];
    var dataLabels = [];
    var dataTypes = {};


    for(i = 0; i < fromsongs.length; i++){
      var the_song = fromsongs[i].Song_From;
      //console.log(the_song,dataLabels );
      var typee = fromsongs[i].typee;
      var mea = createRange(fromsongs[i].measures);
      if(dataLabels.indexOf(the_song) == -1){
        song_dict = {};
        song_dict_info = {};

        song_dict["label"] = the_song;

        song_dict_info["val"] = typee;
        song_dict_info["timeRange"] = mea;
        dataTypes[the_song] = [typee,mea];
        //console.log(dataTypes);

        song_dict["data"] = [song_dict_info];
        dataOut["data"].push(song_dict);
        dataLabels.push(the_song);
      } else{
        song_dict_info = {};
        song_dict_info["val"] = typee;
        song_dict_info["timeRange"] = mea;

        var ind = (dataOut["data"]).map(function(o) { return o.label; }).indexOf(the_song);
        if(ind != -1){
          //console.log(dataTypes[the_song][0], dataTypes[the_song][1])
          if(dataTypes[the_song][0] == typee && arraysEqual(dataTypes[the_song][1], mea) == true){
            console.log("duplicate entry");
          } else{
            dataOut["data"][ind]["data"].push(song_dict_info);
          }
        } else{
          console.log("not in list of dict");
        }
      }
    }



      var strr = JSON.stringify(dataOut, null, 2);
      console.log(strr);

	}


   </script>
</body>

</html>
