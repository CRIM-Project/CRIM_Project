<!DOCTYPE html>
<html>
<head>
  <title>Temporary Page for Heat Map Visualization</title>

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

   <!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

   <!-- Latest compiled JavaScript -->
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
   <!--script data-main="script.js" src="require.js"></script-->
   <script src="script.js"></script>

   <script src="timelines-chart.min.js"></script>
   <!--script src="//unpkg.com/timelines-chart"></script-->



</head>


<body>
 <div class="container-fluid">
   <div class="page-header">
	<h1>Temporary Page for Heat Map Visualization</h1>
   </div>

<div class="row">
	<div class="col-md-1"></div>
	<div class="col-md-10" >
          <div class="input-group" style="width:inherit">
	    <label for="score_title">Search for score title:</label>
            <input type="text" class="form-control" id="score_title">
	    <span class="input-group-btn">
        	<button class="btn btn-secondary" type="button" onclick="search()">Search</button>
            </span>
	        </div>
          <br>
  </div>

  <div class="col-md-10" id="myPlot"></div>

  <div class="col-md-1"></div>
</div>


<div class="container" id="searchResults" style='display:none'>
  <h2>Results</h2>
  <p>Click on the button to toggle between showing and hiding content.</p>
  <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#Description">Collapsible Results</button>
  <div id="Description" class="collapse results">
    <ul id="Mylist">
    </ul>

    <div id='myTable'></div>

  </div>
</div>


<div>
  <p>footer</p>
</div>

 <script type="text/javascript">


 var jsonfile = {};
  $("#score_title").ready(function() {
    $.getJSON('ema.json').done(function (data) {
      jsonfile = data;
      //console.log("jsonfile1, ", jsonfile);
      runcodeafter();
    });
  });
//jquery is done asynchronously so  jsonfile3 is called before the json actually loads!
function runcodeafter(){
  //console.log("jsonfile2, ", jsonfile);
}
//console.log("jsonfile3, ", jsonfile);




function buildResults(results){
  var title = document.getElementById("score_title").value;
  var fromsongs = results;
  console.log("from songs, ", fromsongs);
  console.log("results, ", results);

  var no_results = Object.keys(results).length;
  //console.log("no. results",no_results);
  /// Lets add a info about the query to the Description div ///
  var info = document.getElementById("Description");
  var content = "<h2>" + no_results + "Results for \" "+ title + "</h2>"
  //JSON.stringify(jsonfile["Benedicta es"], null, 2) - does pretty print
  /// lets put the results in a togglable list ///
  var ul = document.getElementById("Mylist");
  for (var i = 0; i< no_results; i++) {
    var li = document.createElement("li");
    var children = ul.children.length + 1;
    li.setAttribute("id", "result"+children);
    li.appendChild(document.createTextNode(i+1+": "+JSON.stringify(fromsongs[i])));
    ul.appendChild(li);
  }
/*
  var tableAttr = Object.keys(results[1]);
  tableAttr.unshift("No.");

  var tbl=$("<table/>").attr("id","resultsTable");
  $("#myTable").append(tbl);
  for(var i = 0; i< no_results; i++)
  {
      for(var x =0; x < tableAttr.length; x ++ ) {
      var tr="<tr>";
      var td1="<td>"+fromsongs[i]["id"]+"</td>";
      var td2="<td>"+fromsongs[i]["name"]+"</td>";
      var td3="<td>"+fromsongs[i]["color"]+"</td></tr>";

     $("#resultsTable").append(tr+td1+td2+td3);
   }

  }
  */

}

/*
>>> JSON.stringify(jsonfile["Benedicta es"][1])
>>> "{"Song_From":": Benedicta es,cælorum Regina","measures":"1","typee":"rt-tnm"}"
>>> Object.keys(jsonfile["Benedicta es"][1])
>>> (3) ["Song_From", "measures", "typee"]
*/




/// hold execution to build chart until something has been searched ///
//$.holdReady( true );
/// function is called with button click///

function clearResults(){
  // removes the previous results -- if they exist
  // and shows the Collapsible results div
  document.getElementById('myPlot').innerHTML = '';
  document.getElementById('Mylist').innerHTML = '';
  document.getElementById('searchResults').style.display = 'block';
}

function search(){
	  var title = document.getElementById("score_title").value ;
    if (title !=''){
      clearResults();
    }

    //console.log(title);
	 // var fromsongs = jsonfile[title];
    /// now that we have searched for something we can build the chart! ///
//  $.holdReady(false);
//$( document ).ready(function() {
    var jsonfile;
    $.getJSON('user_timeline.json').done(function (data) {
      jsonfile = data;
      var title = document.getElementById("score_title").value ;

    buildResults(jsonfile[title]);
    TimelinesChart()
      .data(genData(jsonfile, title,  "Song_B", "Song_A"))
      .zQualitative(true)
      .timeFormat('%Q')
      .xTickFormat(n => +n)
      (document.getElementById('myPlot'));
        });



    //});

}


//buildResults() !!

</script>





</body>

</html>
