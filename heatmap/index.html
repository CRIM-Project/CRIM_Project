<!DOCTYPE html>
<html lang="en">
<head>
  <title>Temporary Page for Heat Map Visualization</title>

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" >

   <!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

   <!-- Latest compiled JavaScript -->
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.bundle.min.js"></script>
   <!--script data-main="script.js" src="require.js"></script-->
   <script src="script.js"></script>

   <script src="timelines-chart.min.js"></script>
   <!--script src="//unpkg.com/timelines-chart"></script-->

   <!-- custom css -->
   <link href="style.css" rel="stylesheet">

</head>


<body>

 <main role="main" class="container">
   <div class="page-header">
<br>
  <h1>Temporary Page for Heat Map Visualization</h1>
  <br>
   </div>

<div class="row">
	<div class="col-md-1"></div>
	<div class="col-md-10" >
    <form class="form-inline" id="search_form">
      <span class="input-group-append" id="search_form">
        <div class="form-row">
          <div class="col-sm-4">
        <div class="input-group mb-3" id="select-form">
          <div class="input-group-prepend">
            <label class="input-group-text" for="inputGroupSelect01">Search by:</label>
          </div>
          <select class="custom-select" id="inputGroupSelect01">
            <option selected>Choose...</option>
            <option value="1">Score Title</option>
            <option value="2">User ID</option>
          </select>
        </div>
      </div>

        <div class="col-sm-8">
          <div class="input-group mb-3" id="search_box">
	    <!--label for="score_title">Search for score title:</label-->


            <input type="text" class="form-control" id="score_title">

        	<button class="btn btn-outline-secondary" type="button"  onclick="search()">Search</button>
            </span>
	        </div>
        </div>
            </div>
          <br>
        </form>
  </div>
  <div class="col-md-1">
    <button type="button" class="btn btn-secondary" data-toggle="tooltip" data-placement="bottom" title="Tooltip on left">
  ?
</button>
  </div>
</div>
<div class="row">
  <div class="col-md-1"></div>
  <div class="col-md-10" id="myPlot"></div>

  <div class="col-md-1"></div>
</div>


<div class="container" id="searchResults" style='display:none'>
  <h2>Results</h2>
  <p>Click on the button to toggle between showing and hiding content displayed in the visualization above.</p>
  <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#Description" aria-expanded="false" aria-controls="Description">Collapsible Results</button>
  <br>
  <div class="collapse" id="Description">
    <div id='myTable'> </div>

    </div>
</div>

</main>
<footer class="footer">
      <div class="container">
        <span class="text-muted">Supported by <a href="https://www.haverford.edu/library/digital-scholarship"> Haverford Digital Scholarship</a> for the <a href="https://sites.google.com/a/haverford.edu/crim-project/"> CRIM project</a></span>
      </div>
    </footer>

 <script type="text/javascript">

 $(function () {
   $('[data-toggle="tooltip"]').tooltip()
 })

 var jsonfile = {};
  $("#score_title").ready(function() {
    $.getJSON('ema.json').done(function (data) {
      jsonfile = data;
      //console.log("jsonfile1, ", jsonfile);
    //  runcodeafter();
    });
  });
/* //jquery is done asynchronously so  jsonfile3 is called before the json actually loads!
  console.log("jsonfile2, ", jsonfile);
}
console.log("jsonfile3, ", jsonfile);
*/

$.makeTable = function (mydata) {
    var table = $("<table class='table table-hover table-bordered'>");
    var tblHeader = "<tr> <th scope='col'> No. </th>";
    for (var k in mydata[0]) tblHeader += "<th scope='col'>" + k + "</th>";
    tblHeader += "</tr>";
    $(tblHeader).appendTo(table);
    $.each(mydata, function (index, value) {
        var TableRow = "<tr> <td scope='row'>" + index + "</td>";
        $.each(value, function (key, val) {
            TableRow += "<td>" + val + "</td>";
        });
        TableRow += "</tr>";
        $(table).append(TableRow);
    });
    return ($(table));
};


function buildResults(results){
  var title = document.getElementById("score_title").value;
  var fromsongs = results;
  console.log("from songs, ", fromsongs);
  console.log("results, ", results);

  var mydata = eval(results);
  var table = $.makeTable(mydata);
  $(table).appendTo("#myTable");

}

/*
>>> JSON.stringify(jsonfile["Benedicta es"][1])
>>> "{"Song_From":": Benedicta es,cÃ¦lorum Regina","measures":"1","typee":"rt-tnm"}"
>>> Object.keys(jsonfile["Benedicta es"][1])
>>> (3) ["Song_From", "measures", "typee"]
*/


function clearResults(){
  // removes the previous results -- if they exist
  // and shows the Collapsible results div
  document.getElementById('myPlot').innerHTML = '';
  document.getElementById('myTable').innerHTML = '';
  document.getElementById('searchResults').style.display = 'block';
}

function search(){
	  var title = document.getElementById("score_title").value ;
    if (title !=''){
      clearResults();
    }

    //console.log(title);
	 // var fromsongs = jsonfile[title];
    /// now that we have searched for something we can build the chart! ///
//  $.holdReady(false);
//$( document ).ready(function() {
    var jsonfile;
    $.getJSON('ema_2.json').done(function (data) {
      jsonfile = data;
      var title = document.getElementById("score_title").value ;

    buildResults(jsonfile[title]);
    TimelinesChart()
      .data(genData(jsonfile, title,  "Song_From", "record_id"))
      .zQualitative(true)
      .timeFormat('%Q')
      .xTickFormat(n => +n)
      (document.getElementById('myPlot'));
        });
}

</script>



</body>

</html>
